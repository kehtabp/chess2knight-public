let e=null,t=null,n=navigator.language||"en-US",r=[],i=new Set;function o(){try{if(void 0!==Intl.Locale)try{const e=new Intl.Locale(n);if(e.weekInfo&&void 0!==e.weekInfo.firstDay)return 7===e.weekInfo.firstDay?0:e.weekInfo.firstDay}catch(e){}const e=n.toLowerCase().split("-"),t=e[0],r=e[1];return r&&["us","ca","ph","jp","kr","th","tw","il","sa","ae","kw","qa","bh","om","jo","lb","sy","iq","ye","eg","ly","sd","ma","dz","tn","so","dj","er","et","ke","tz","ug","rw","bi","mw","zm","zw","bw","sz","ls","mg","mu","sc","mz","ao","na","za"].includes(r)||["ja","ko","th"].includes(t)&&!r?0:"en"!==t||r&&!["us","ca","ph"].includes(r)?1:0}catch(e){return 1}}let a=new Intl.DateTimeFormat(n,{weekday:"long",year:"numeric",month:"long",day:"numeric"});function s(e){try{if(!e)return"";if("string"==typeof e){const t=new Date(e);if(isNaN(t.getTime()))return"";e=t}return a.format(e)}catch(e){return""}}function l(e){try{let t,r,i,o;o=!(!e.recurring&&!e.rrule),e.rrule?(t=new Date(e.rrule.dtstart),r=new Date(t.getTime()+108e5),i=!1):(t=new Date(e.start),r=new Date(e.end),i="string"!=typeof e.start||!e.start.includes("T"));let a,l=null;if(o&&(l=c(e)),o)if("Weekly"===e.recurring)a=`Weekly on ${t.toLocaleDateString(n,{weekday:"long"})} at ${t.toLocaleTimeString(n,{hour:"2-digit",minute:"2-digit"})}`;else if("Monthly"===e.recurring){const e=t.toLocaleTimeString(n,{hour:"2-digit",minute:"2-digit"});a=`Monthly on the ${t.getDate()}${d(t.getDate())} at ${e}`}else e.rrule&&(a=`Recurring: ${t.toLocaleDateString(n,{weekday:"long"})} at ${t.toLocaleTimeString(n,{hour:"2-digit",minute:"2-digit"})}`);else a=s(t),i||(a+=` ${t.toLocaleTimeString(n,{hour:"2-digit",minute:"2-digit"})}`);return`\n            <div class="popup-content">\n                <h3>${e.title}</h3>\n                <p><strong>‚è∞ ${a}</strong></p>\n                ${i||o?"":`<p>Ends: ${s(r)} ${r.toLocaleTimeString(n,{hour:"2-digit",minute:"2-digit"})}</p>`}\n                ${l?`<p><strong>üìÖ Next: ${l}</strong></p>`:""}\n                ${e.description?`<p><strong>üìù Description:</strong> ${e.description}</p>`:""}\n                ${e.website?`<p><a href="${e.website}" target="_blank" rel="noopener noreferrer">üåê Visit Website</a></p>`:""}\n                ${e.socials?`\n                    <div class="social-links">\n                        ${e.socials.facebook?`<a href="${e.socials.facebook}" target="_blank" rel="noopener noreferrer" title="Facebook">üìò</a>`:""}\n                        ${e.socials.twitter?`<a href="${e.socials.twitter}" target="_blank" rel="noopener noreferrer" title="Twitter">üê¶</a>`:""}\n                        ${e.socials.instagram?`<a href="${e.socials.instagram}" target="_blank" rel="noopener noreferrer" title="Instagram">üì∏</a>`:""}\n                    </div>\n                `:""}\n            </div>\n        `}catch(t){return`<div class="popup-content"><h3>${e.title}</h3></div>`}}function d(e){if(e>=11&&e<=13)return"th";switch(e%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}}function c(e){try{const t=new Date,r=new Date(e.start);if("Weekly"===e.recurring){const e=r.getDay(),i=t.getDay(),o=60*r.getHours()+r.getMinutes(),a=60*t.getHours()+t.getMinutes();let s=e-i;0===s&&a>=o?s=7:s<0&&(s+=7);const l=new Date(t);return l.setDate(t.getDate()+s),l.setHours(r.getHours(),r.getMinutes(),0,0),l.toLocaleDateString(n,{weekday:"long",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}if("Monthly"===e.recurring){const e=r.getDate(),i=new Date(t);return i.setDate(e),i.setHours(r.getHours(),r.getMinutes(),0,0),i<=t&&(i.setMonth(i.getMonth()+1),i.getDate()!==e&&i.setDate(0)),i.toLocaleDateString(n,{month:"long",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})}return null}catch(e){return null}}function u(t){const n=document.getElementById("calendar");if(!n)return;let a;return r=t,e=new FullCalendar.Calendar(n,{initialView:window.innerWidth<=768?"listWeek":"dayGridMonth",headerToolbar:{left:window.innerWidth<=768?"prev,next":"prev,next today",center:"title",right:window.innerWidth<=768?"today":""},height:"100%",expandRows:!0,stickyHeaderDates:!1,nowIndicator:!0,handleWindowResize:!0,dayMaxEvents:!1,moreLinkClick:"popover",eventDisplay:"block",displayEventEnd:!1,eventOrder:!1,eventTimeFormat:{hour:"2-digit",minute:"2-digit",hour12:!0},initialDate:new Date,firstDay:o(),fixedWeekCount:!1,showNonCurrentDates:!1,views:{listWeek:{listDayFormat:{weekday:"long"},listDaySideFormat:{month:"short",day:"numeric"},noEventsMessage:"No events this week",duration:{days:14}}},eventDidMount:function(e){},eventClick:function(e){e.event.id&&window.showMarkerPopup&&window.showMarkerPopup(e.event.id),window.toggleMap&&!1===window.isMapExpanded&&window.toggleMap()},eventContent:function(e){const t=e.event.extendedProps.type||"club",n={club:{icon:"‚ôüÔ∏è",label:"Club"},tournament:{icon:"üëë",label:"Tournament"},workshop:{icon:"üìö",label:"Workshop"},online:{icon:"üíª",label:"Online"},casual:{icon:"‚òï",label:"Casual"}}[t]||{icon:"‚ôï",label:"Event"};return{html:`\n                    <div class="chess-calendar-event" data-event-type="${t}">\n                        <div class="chess-event-icon">${n.icon}</div>\n                        <div class="chess-event-content">\n                            <div class="chess-event-title">${e.event.title}</div>\n                            <div class="chess-event-type">${n.label}</div>\n                        </div>\n                    </div>\n                `}}}),e.render(),window.addEventListener("mapBoundsChanged",(e=>{i=new Set(e.detail.visibleEventIds),g(r)})),window.addEventListener("resize",(()=>{clearTimeout(a),a=setTimeout((()=>{if(e){const t=e.getDate(),n=e.view.type,r=window.innerWidth<=768,i=e.getEvents().map((e=>({id:e.id,title:e.title,start:e.start,end:e.end,backgroundColor:e.backgroundColor,borderColor:e.borderColor,extendedProps:e.extendedProps})));!r||"dayGridMonth"!==n&&"dayGridWeek"!==n?r||"listWeek"!==n||e.changeView("dayGridMonth"):e.changeView("listWeek"),e.setOption("headerToolbar",{left:r?"prev,next":"prev,next today",center:"title",right:r?"today":""}),e.setOption("dayMaxEvents",!1),e.setOption("expandRows",!0),e.setOption("displayEventEnd",!r),e.updateSize(),e.gotoDate(t),setTimeout((()=>{e.getEvents().length!==i.length&&window.updateEventsDisplay&&window.updateEventsDisplay()}),50)}}),100)})),g(t),e}function g(t){if(e){e.removeAllEvents();const n=t.filter((e=>!(!e.recurring&&!e.rrule||!i.has(e.id))||i.has(e.id))).map(((e,t)=>{try{const n=w(e.type),r={id:e.id,title:e.title,backgroundColor:n,borderColor:n,textColor:"#ffffff",classNames:[`chess-event-${e.type||"default"}`],order:t};if(!e.recurring||"No, one-time event"===e.recurring){if(e.rrule){const t={freq:e.rrule.freq,dtstart:e.rrule.dtstart,interval:e.rrule.interval||1};return e.rrule.byweekday&&(t.byweekday=e.rrule.byweekday),e.rrule.until&&(t.until=e.rrule.until),{...r,rrule:t,duration:"03:00",extendedProps:{type:e.type,location:e.location,website:e.website,socials:e.socials,isRecurring:!0}}}return{...r,start:e.start,end:e.end,allDay:!e.start.includes("T"),extendedProps:{type:e.type,location:e.location,website:e.website,socials:e.socials,isRecurring:!1}}}if("Weekly"===e.recurring){const t=new Date(e.start).getDay();return{...r,daysOfWeek:[t],startTime:e.start.includes("T")?e.start.split("T")[1]:"18:00:00",endTime:e.end&&e.end.includes("T")?e.end.split("T")[1]:"21:00:00",startRecur:e.start.split("T")[0],endRecur:e.endRecur||"2025-12-31",extendedProps:{type:e.type,location:e.location,website:e.website,socials:e.socials,isRecurring:!0}}}if("Monthly"===e.recurring){const t=new Date(e.start).getDate();return{...r,rrule:{freq:"monthly",dtstart:e.start,bymonthday:t,until:e.endRecur||"2025-12-31"},duration:"03:00",extendedProps:{type:e.type,location:e.location,website:e.website,socials:e.socials,isRecurring:!0}}}}catch(t){return{id:e.id,title:e.title+" (Error)",start:e.start||(new Date).toISOString(),backgroundColor:"#e74c3c",borderColor:"#e74c3c",textColor:"#ffffff",extendedProps:{type:e.type,isRecurring:!1}}}}));try{e.addEventSource({events:n})}catch(e){}}}function w(e){const t={club:"#3498db",tournament:"#f39c12",workshop:"#9b59b6",online:"#9b59b6",casual:"#27ae60",default:"#34495e"};return t[e]||t.default}function p(t){if(!e)return;const n=new Date,r=n.getDay()-(t||0),i=new Date(n);i.setDate(n.getDate()-r),e.gotoDate(i)}export{u as initCalendar,g as updateEventDisplay,p as setCalendarToStartOfWeek,l as createPopupContent,o as getLocaleFirstDay};